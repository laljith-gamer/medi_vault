<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediVault - Secure Healthcare Records Management</title>
    <meta name="description" content="Secure medical records management system for hospitals. ABDM compliant, FHIR R4 compatible healthcare data management.">
    <link rel="stylesheet" href="styles.css">
    
    <!-- FIXED: Multiple CDN options with fallback -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js" 
            onerror="loadSupabaseBackup()"></script>
    
    <!-- Backup CDN loader -->
    <script>
        function loadSupabaseBackup() {
            console.warn("‚ö†Ô∏è jsDelivr CDN failed, trying unpkg backup...");
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/@supabase/supabase-js@2';
            script.onerror = () => {
                console.error("‚ùå All CDN sources failed. Please check your internet connection.");
                alert("Failed to load required libraries. Please refresh the page or check your internet connection.");
            };
            document.head.appendChild(script);
        }
    </script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loader"></div>
        <p>Initializing secure connection...</p>
    </div>

    <!-- Connection Status Bar -->
    <div id="connectionStatus" class="connection-status hidden"></div>

    <!-- ============================================================================ -->
    <!-- SIGNUP SECTION -->
    <!-- ============================================================================ -->
    <section id="signupSection" class="auth-section hidden">
        <div class="auth-container">
            <div class="auth-header">
                <h1>üè• MediVault</h1>
                <p class="subtitle">Join our secure medical records network</p>
            </div>

            <!-- Step 1: Hospital Verification -->
            <div id="verificationStep" class="form-step">
                <h2>Hospital Verification</h2>
                <p class="text-sm mb-4">Verify your hospital credentials to begin registration</p>
                
                <div class="form-group">
                    <label for="hospitalId">Hospital ID *</label>
                    <input type="text" id="hospitalId" placeholder="e.g., AIIMS-DEL-001" required>
                </div>

                <div class="form-group">
                    <label for="licenseNumber">License Number *</label>
                    <input type="text" id="licenseNumber" placeholder="e.g., DL/MED/2023/001" required>
                </div>

                <button type="button" id="verifyBtn" class="btn btn-primary">
                    Verify Hospital
                </button>

                <p class="text-center mt-4">
                    Already have an account? 
                    <a href="#" onclick="showLogin()">Sign in here</a>
                </p>
            </div>

            <!-- Step 2: Registration Form -->
            <div id="registrationStep" class="form-step hidden">
                <h2>Complete Registration</h2>
                <p class="text-sm mb-4">Set up your admin account</p>

                <form id="signupForm">
                    <div class="form-group">
                        <label for="hospitalName">Hospital Name</label>
                        <input type="text" id="hospitalName" readonly>
                    </div>

                    <div class="form-group">
                        <label for="adminEmail">Admin Email *</label>
                        <input type="email" id="adminEmail" placeholder="admin@hospital.com" required>
                    </div>

                    <div class="form-group">
                        <label for="contactPhone">Contact Phone *</label>
                        <input type="tel" id="contactPhone" 
                               placeholder="+919876543210" 
                               pattern="\+91[0-9]{10,11}" required>
                        <small>Format: +91XXXXXXXXXX (mobile) or +91XXXXXXXXXXX (landline)</small>
                    </div>

                    <div class="form-group">
                        <label for="password">Password *</label>
                        <div class="password-input">
                            <input type="password" id="password" 
                                   placeholder="Enter strong password" required>
                            <span id="togglePassword" class="toggle-password">üëÅÔ∏è‚Äçüó®Ô∏è</span>
                        </div>
                        <small>Min 8 characters, include uppercase, lowercase, number & special character</small>
                        <div id="passwordStrength" class="password-strength"></div>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password *</label>
                        <input type="password" id="confirmPassword" 
                               placeholder="Re-enter password" required>
                        <div id="passwordMatch" class="password-match"></div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        Complete Registration
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- ============================================================================ -->
    <!-- LOGIN SECTION -->
    <!-- ============================================================================ -->
    <section id="loginSection" class="auth-section hidden">
        <div class="auth-container">
            <div class="auth-header">
                <h1>üè• MediVault</h1>
                <p class="subtitle">Sign in to your hospital dashboard</p>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="loginHospitalId">Hospital ID *</label>
                    <input type="text" id="loginHospitalId" 
                           placeholder="e.g., AIIMS-DEL-001" required>
                </div>

                <div class="form-group">
                    <label for="loginPassword">Password *</label>
                    <div class="password-input">
                        <input type="password" id="loginPassword" 
                               placeholder="Enter your password" required>
                        <span id="toggleLoginPassword" class="toggle-password">üëÅÔ∏è‚Äçüó®Ô∏è</span>
                    </div>
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="rememberMe">
                        <span>Remember me</span>
                    </label>
                </div>

                <button type="submit" class="btn btn-primary">
                    Sign In
                </button>

                <p class="text-center mt-4">
                    <a href="#" id="forgotPassword">Forgot password?</a>
                </p>

                <p class="text-center mt-2">
                    New to MediVault? 
                    <a href="#" onclick="showSignup()">Create an account</a>
                </p>
            </form>
        </div>
    </section>

    <!-- ============================================================================ -->
    <!-- DASHBOARD SECTION -->
    <!-- ============================================================================ -->
    <section id="dashboardSection" class="dashboard-section hidden">
        <!-- Dashboard Header -->
        <header class="dashboard-header">
            <div class="header-content">
                <div class="hospital-info">
                    <h1 id="dashboardHospitalName">Hospital Name</h1>
                    <p id="dashboardHospitalId">ID: HOSP-001</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="switchDashboardView('dashboard')">
                        üìä Dashboard
                    </button>
                    <button class="btn btn-primary" onclick="switchDashboardView('addRecord')">
                        ‚ûï Add Record
                    </button>
                    <button class="btn btn-danger" id="logoutBtn">
                        üö™ Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- ============== DASHBOARD VIEW ============== -->
            <div id="dashboardView" class="dashboard-view">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìã</div>
                        <div class="stat-details">
                            <h3 id="recordCount">0</h3>
                            <p>Total Medical Records</p>
                        </div>
                    </div>
                </div>

                <!-- Recent Records -->
                <div class="records-section">
                    <h2>Recent Medical Records</h2>
                    <div id="recordsList" class="records-list">
                        <p class="text-center">Medical records will appear here once created</p>
                    </div>
                </div>
            </div>

            <!-- ============== ADD RECORD VIEW ============== -->
            <div id="addRecordView" class="add-record-view hidden">
                <h2>Add New Medical Record</h2>

                <!-- Patient Verification -->
                <div class="verification-card">
                    <h3>Patient Verification</h3>
                    <p class="text-sm mb-4">Verify patient before adding medical record</p>

                    <div class="verification-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patientId">Patient ID *</label>
                                <input type="text" id="patientId" 
                                       placeholder="e.g., PAT-2025-001" required>
                            </div>

                            <div class="form-group">
                                <label for="patientPhone">Patient Phone *</label>
                                <input type="tel" id="patientPhone" 
                                       placeholder="+919876543210" 
                                       pattern="\+91[6-9][0-9]{9}" required>
                            </div>

                            <div class="form-group">
                                <label for="patientName">Patient Name *</label>
                                <input type="text" id="patientName" 
                                       placeholder="Full name" required>
                            </div>
                        </div>

                        <button type="button" id="verifyPatientBtn" class="btn btn-primary">
                            Verify Patient
                        </button>

                        <div id="verificationStatus" class="verification-status">
                            ‚úó Patient Not Verified
                        </div>

                        <div id="patientInfo" class="patient-info hidden"></div>
                    </div>
                </div>

                <!-- Medical Record Form -->
                <div id="recordFormSection" class="record-form-section hidden">
                    <form id="addRecordForm">
                        <!-- Visit Information -->
                        <div class="form-section">
                            <h3>Visit Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="visitType">Visit Type *</label>
                                    <select id="visitType" required>
                                        <option value="OPD">OPD</option>
                                        <option value="IPD">IPD</option>
                                        <option value="Emergency">Emergency</option>
                                        <option value="Follow-up">Follow-up</option>
                                        <option value="Telemedicine">Telemedicine</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="recordType">Record Type *</label>
                                    <select id="recordType" required>
                                        <option value="OPD Consultation">OPD Consultation</option>
                                        <option value="Prescription">Prescription</option>
                                        <option value="Diagnostic Report - Pathology">Diagnostic Report - Pathology</option>
                                        <option value="Diagnostic Report - Radiology">Diagnostic Report - Radiology</option>
                                        <option value="Discharge Summary">Discharge Summary</option>
                                        <option value="Surgery Record">Surgery Record</option>
                                        <option value="Emergency Record">Emergency Record</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Doctor Information -->
                        <div class="form-section">
                            <h3>Doctor Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="doctorName">Doctor Name *</label>
                                    <input type="text" id="doctorName" 
                                           placeholder="Dr. Name" required>
                                </div>

                                <div class="form-group">
                                    <label for="doctorRegNumber">Registration Number *</label>
                                    <input type="text" id="doctorRegNumber" 
                                           placeholder="NMC-I-12345" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="doctorQualification">Qualification *</label>
                                    <input type="text" id="doctorQualification" 
                                           placeholder="MBBS, MD" required>
                                </div>

                                <div class="form-group">
                                    <label for="doctorSpecialization">Specialization</label>
                                    <input type="text" id="doctorSpecialization" 
                                           placeholder="General Medicine">
                                </div>
                            </div>
                        </div>

                        <!-- Clinical Information -->
                        <div class="form-section">
                            <h3>Clinical Information</h3>
                            
                            <div class="form-group">
                                <label for="chiefComplaint">Chief Complaint *</label>
                                <textarea id="chiefComplaint" rows="3" 
                                          placeholder="Patient's main complaint" required></textarea>
                            </div>

                            <div class="form-group">
                                <label for="complaintDuration">Complaint Duration *</label>
                                <input type="text" id="complaintDuration" 
                                       placeholder="e.g., 3 days, 2 weeks, 1 month" required>
                                <small>Specify how long the patient has had this complaint</small>
                            </div>

                            <div class="form-group">
                                <label for="diagnosis">Provisional Diagnosis *</label>
                                <textarea id="diagnosis" rows="3" 
                                          placeholder="Provisional diagnosis" required></textarea>
                            </div>

                            <div class="form-group">
                                <label for="treatment">Treatment Plan *</label>
                                <textarea id="treatment" rows="4" 
                                          placeholder="Detailed treatment plan" required></textarea>
                            </div>

                            <div class="form-group">
                                <label for="medications">Medications</label>
                                <textarea id="medications" rows="4" 
                                          placeholder="List medications (one per line)"></textarea>
                                <small>Enter one medication per line or as JSON format</small>
                            </div>

                            <div class="form-group">
                                <label for="severity">Severity *</label>
                                <select id="severity" required>
                                    <option value="Low">Low</option>
                                    <option value="Medium" selected>Medium</option>
                                    <option value="High">High</option>
                                    <option value="Critical">Critical</option>
                                </select>
                            </div>
                        </div>

                        <!-- Follow-up Information -->
                        <div class="form-section">
                            <h3>Follow-up & Additional Notes</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="followUpDate">Follow-up Date</label>
                                    <input type="date" id="followUpDate">
                                </div>

                                <div class="form-group">
                                    <label for="followUpInstructions">Follow-up Instructions</label>
                                    <input type="text" id="followUpInstructions" 
                                           placeholder="Follow-up instructions">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="notes">Additional Notes</label>
                                <textarea id="notes" rows="3" 
                                          placeholder="Any additional notes"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="attachments">Attachments</label>
                                <input type="file" id="attachments" multiple 
                                       accept=".pdf,.jpg,.jpeg,.png,.doc,.docx">
                                <small>Upload relevant documents (PDF, Images, Word docs)</small>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-lg">
                                Add Medical Record
                            </button>
                            <button type="button" class="btn btn-secondary btn-lg" 
                                    onclick="switchDashboardView('dashboard')">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Application Script -->
    <script src="app.js"></script>
</body>
</html>
