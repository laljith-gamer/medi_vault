<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MediVault - Secure Medical Records Platform">
    <title>MediVault - Secure Medical Records Platform</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen" role="status" aria-live="polite">
        <div class="loader" aria-hidden="true"></div>
        <p>Initializing secure connection...</p>
    </div>

    <!-- Connection Status Notification -->
    <div id="connectionStatus" class="connection-status hidden" role="alert" aria-live="assertive"></div>

    <!-- Notification Container -->
    <div id="notification" class="notification" role="alert" aria-live="polite"></div>

    <!-- SIGNUP SECTION -->
    <section id="signupSection" class="auth-section hidden" aria-labelledby="signup-title">
        <div class="auth-container">
            <div class="auth-header">
                <h1 id="signup-title">üè• MediVault</h1>
                <p class="subtitle">Join our secure medical records network</p>
            </div>

            <div id="verificationStep" class="form-step">
                <h2 class="text-center mb-4">Verify Hospital Credentials</h2>
                <p class="text-center text-sm" style="color: var(--gray-500); margin-bottom: 2rem;">
                    Verify your hospital credentials to begin registration
                </p>

                <div class="form-group">
                    <label for="hospitalId">Hospital ID *</label>
                    <input type="text" id="hospitalId" placeholder="e.g., AIIMS-DEL-001" required aria-required="true">
                </div>

                <div class="form-group">
                    <label for="licenseNumber">License Number *</label>
                    <input type="text" id="licenseNumber" placeholder="e.g., DL/MED/2023/001" required aria-required="true">
                </div>

                <button type="button" id="verifyBtn" class="btn btn-primary btn-lg">
                    Verify Hospital
                </button>

                <p class="text-center mt-4 text-sm">
                    Already have an account? <a href="#" id="showLogin">Sign in here</a>
                </p>
            </div>

            <div id="registrationStep" class="form-step hidden">
                <h2 class="text-center mb-4">Set up your admin account</h2>
                <form id="signupForm">
                    <div class="form-group">
                        <label for="hospitalName">Hospital Name</label>
                        <input type="text" id="hospitalName" readonly aria-readonly="true">
                    </div>

                    <div class="form-group">
                        <label for="adminEmail">Admin Email *</label>
                        <input type="email" id="adminEmail" placeholder="admin@hospital.com" required aria-required="true">
                    </div>

                    <div class="form-group">
                        <label for="contactPhone">Contact Phone *</label>
                        <div class="phone-input-group">
                            <select id="countryCode" class="country-code-select" aria-label="Country code">
                                <option value="+91" selected>üáÆüá≥ +91</option>
                            </select>
                            <input type="tel" id="contactPhone" placeholder="9876543210" pattern="[0-9]{10}" maxlength="10" required aria-required="true">
                        </div>
                        <small>Enter 10-digit mobile number</small>
                    </div>

                    <div class="form-group">
                        <label for="password">Password *</label>
                        <div class="password-input">
                            <input type="password" id="password" placeholder="Create strong password" required aria-required="true">
                            <button type="button" id="togglePassword" class="toggle-password" aria-label="Toggle password visibility">üëÅÔ∏è</button>
                        </div>
                        <div id="passwordStrength" class="password-strength" aria-live="polite"></div>
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword">Confirm Password *</label>
                        <input type="password" id="confirmPassword" placeholder="Re-enter password" required aria-required="true">
                        <div id="passwordMatch" class="password-match" aria-live="polite"></div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg">
                        Complete Registration
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- LOGIN SECTION -->
    <section id="loginSection" class="auth-section hidden" aria-labelledby="login-title">
        <div class="auth-container">
            <div class="auth-header">
                <h1 id="login-title">üè• MediVault</h1>
                <p class="subtitle">Sign in to your hospital dashboard</p>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="loginHospitalId">Hospital ID *</label>
                    <input type="text" id="loginHospitalId" placeholder="e.g., AIIMS-DEL-001" required aria-required="true">
                </div>

                <div class="form-group">
                    <label for="loginPassword">Password *</label>
                    <div class="password-input">
                        <input type="password" id="loginPassword" placeholder="Enter your password" required aria-required="true">
                        <button type="button" id="toggleLoginPassword" class="toggle-password" aria-label="Toggle password visibility">üëÅÔ∏è</button>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="rememberMe">
                    <label for="rememberMe">Remember me</label>
                </div>

                <button type="submit" class="btn btn-primary btn-lg mt-4">
                    Sign In
                </button>

                <p class="text-center mt-4 text-sm">
                    <a href="#" id="forgotPassword">Forgot password?</a>
                </p>

                <p class="text-center mt-2 text-sm">
                    Don't have an account? <a href="#" id="showSignup">Register here</a>
                </p>
            </form>
        </div>
    </section>

    <!-- DASHBOARD SECTION -->
    <section id="dashboardSection" class="dashboard-section hidden" aria-labelledby="dashboard-title">
        <header class="dashboard-header">
            <div class="header-content">
                <div class="hospital-info">
                    <h1 id="dashboardHospitalName">Hospital Name</h1>
                    <p id="dashboardHospitalId">ID: HOSPITAL-ID</p>
                </div>
                <nav class="header-actions" aria-label="Main navigation">
                    <button id="showDashboardView" class="btn btn-secondary">Dashboard</button>
                    <button id="showAddRecordView" class="btn btn-primary">Add Record</button>
                    <button id="logoutBtn" class="btn btn-danger">Logout</button>
                </nav>
            </div>
        </header>

        <main class="dashboard-content">
            <!-- Dashboard View -->
            <div id="dashboardView" class="dashboard-view">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" aria-hidden="true">üìã</div>
                        <div class="stat-details">
                            <h3 id="totalRecords">0</h3>
                            <p>Total Medical Records</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" aria-hidden="true">‚úÖ</div>
                        <div class="stat-details">
                            <h3 id="activeRecords">0</h3>
                            <p>Active Records</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" aria-hidden="true">üë•</div>
                        <div class="stat-details">
                            <h3 id="totalPatients">0</h3>
                            <p>Total Patients</p>
                        </div>
                    </div>
                </div>

                <div class="records-section">
                    <h2>üìÅ Recent Medical Records</h2>
                    <div id="recordsList" class="records-list">
                        <div class="empty-state">
                            <p>Medical records will appear here once created</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Record View -->
            <div id="addRecordView" class="add-record-view hidden">
                <!-- Patient Verification Card -->
                <div class="verification-card">
                    <h3>üîç Patient Verification</h3>
                    <p class="text-sm" style="color: var(--gray-500); margin-bottom: 1.5rem;">
                        Enter patient details to verify and add medical record
                    </p>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="patientId">Patient ABHA Number</label>
                            <input type="text" id="patientId" placeholder="14-digit ABHA" maxlength="14" pattern="[0-9]{14}" aria-describedby="patientIdHelp">
                            <small id="patientIdHelp">Enter 14-digit ABHA number</small>
                        </div>
                        <div class="form-group">
                            <label for="patientPhone">Phone Number</label>
                            <input type="tel" id="patientPhone" placeholder="10-digit mobile" maxlength="10" pattern="[0-9]{10}" aria-describedby="patientPhoneHelp">
                            <small id="patientPhoneHelp">Enter 10-digit mobile number</small>
                        </div>
                    </div>

                    <button type="button" id="verifyPatientBtn" class="btn btn-primary">
                        Verify Patient
                    </button>

                    <div id="verificationStatus" class="verification-status" role="status" aria-live="polite">
                        ‚ö†Ô∏è Patient Not Verified
                    </div>

                    <div id="patientInfo" class="patient-info hidden">
                        <div class="patient-details">
                            <h4>Patient Information</h4>
                            <p>Enter ABHA Number and Phone to verify</p>
                        </div>
                    </div>

                    <div id="newPatientPrompt" class="new-patient-prompt hidden">
                        <p style="text-align: center; margin: 1rem 0; color: var(--gray-600); font-weight: 600;">
                            Patient not found in system
                        </p>
                        <button type="button" id="registerNewPatientBtn" class="btn btn-secondary">
                            Register New Patient
                        </button>
                    </div>
                </div>

                <!-- New Patient Registration Form -->
                <div id="newPatientForm" class="record-form-section hidden">
                    <h3>‚ûï Register New Patient</h3>
                    <form id="patientRegistrationForm">
                        <div class="form-section">
                            <h3>Personal Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newPatientName">Full Name *</label>
                                    <input type="text" id="newPatientName" required aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label for="newPatientDOB">Date of Birth *</label>
                                    <input type="date" id="newPatientDOB" required aria-required="true">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newPatientGender">Gender *</label>
                                    <select id="newPatientGender" required aria-required="true">
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="newPatientBloodGroup">Blood Group</label>
                                    <select id="newPatientBloodGroup">
                                        <option value="">Select Blood Group</option>
                                        <option value="A+">A+</option>
                                        <option value="A-">A-</option>
                                        <option value="B+">B+</option>
                                        <option value="B-">B-</option>
                                        <option value="AB+">AB+</option>
                                        <option value="AB-">AB-</option>
                                        <option value="O+">O+</option>
                                        <option value="O-">O-</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Contact Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newPatientPhone">Phone Number *</label>
                                    <input type="tel" id="newPatientPhone" readonly aria-readonly="true">
                                    <small>From verification above</small>
                                </div>
                                <div class="form-group">
                                    <label for="newPatientEmail">Email</label>
                                    <input type="email" id="newPatientEmail" placeholder="patient@email.com">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="newPatientAddress">Address</label>
                                <input type="text" id="newPatientAddress" placeholder="Street address">
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newPatientCity">City</label>
                                    <input type="text" id="newPatientCity">
                                </div>
                                <div class="form-group">
                                    <label for="newPatientState">State</label>
                                    <input type="text" id="newPatientState">
                                </div>
                                <div class="form-group">
                                    <label for="newPatientPincode">Pincode</label>
                                    <input type="text" id="newPatientPincode" pattern="[0-9]{6}" maxlength="6">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Emergency Contact</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="emergencyContactName">Contact Name</label>
                                    <input type="text" id="emergencyContactName">
                                </div>
                                <div class="form-group">
                                    <label for="emergencyContactPhone">Contact Phone</label>
                                    <div class="phone-input-group">
                                        <select id="emergencyCountryCode" class="country-code-select" aria-label="Emergency contact country code">
                                            <option value="+91" selected>üáÆüá≥ +91</option>
                                            <option value="+1">üá∫üá∏ +1</option>
                                            <option value="+44">üá¨üáß +44</option>
                                        </select>
                                        <input type="tel" id="emergencyContactPhone" placeholder="9876543210" maxlength="10">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="emergencyContactRelation">Relation</label>
                                    <input type="text" id="emergencyContactRelation" placeholder="e.g., Spouse">
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" id="cancelNewPatient" class="btn btn-secondary">Cancel</button>
                            <button type="submit" class="btn btn-primary">Register Patient</button>
                        </div>
                    </form>
                </div>

                <!-- Medical Record Form -->
                <div id="recordFormSection" class="record-form-section hidden">
                    <h3>üìù Add Medical Record</h3>
                    <form id="addRecordForm">
                        <div class="form-section">
                            <h3>Visit Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="visitDate">Visit Date *</label>
                                    <input type="date" id="visitDate" required aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label for="visitTime">Visit Time</label>
                                    <input type="time" id="visitTime">
                                </div>
                                <div class="form-group">
                                    <label for="visitType">Visit Type *</label>
                                    <select id="visitType" required aria-required="true">
                                        <option value="">Select Type</option>
                                        <option value="OPD">OPD</option>
                                        <option value="IPD">IPD</option>
                                        <option value="Emergency">Emergency</option>
                                        <option value="Follow-up">Follow-up</option>
                                        <option value="Telemedicine">Telemedicine</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Doctor Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="doctorName">Doctor Name *</label>
                                    <input type="text" id="doctorName" required aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label for="doctorRegistration">Registration Number *</label>
                                    <input type="text" id="doctorRegistration" required aria-required="true">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="doctorQualification">Qualification *</label>
                                    <input type="text" id="doctorQualification" placeholder="MBBS, MD" required aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label for="doctorSpecialization">Specialization</label>
                                    <input type="text" id="doctorSpecialization" placeholder="e.g., Cardiology">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Clinical Information</h3>
                            <div class="form-group">
                                <label for="chiefComplaint">Chief Complaint *</label>
                                <textarea id="chiefComplaint" rows="3" required aria-required="true"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="complaintDuration">Complaint Duration</label>
                                <input type="text" id="complaintDuration" placeholder="e.g., 3 days">
                            </div>
                            <div class="form-group">
                                <label for="presentIllness">History of Present Illness</label>
                                <textarea id="presentIllness" rows="3"></textarea>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Vital Signs</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="bloodPressure">Blood Pressure</label>
                                    <input type="text" id="bloodPressure" placeholder="120/80">
                                </div>
                                <div class="form-group">
                                    <label for="pulse">Pulse Rate</label>
                                    <input type="text" id="pulse" placeholder="72 bpm">
                                </div>
                                <div class="form-group">
                                    <label for="temperature">Temperature</label>
                                    <input type="text" id="temperature" placeholder="98.6¬∞F">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="respiratoryRate">Respiratory Rate</label>
                                    <input type="text" id="respiratoryRate" placeholder="16/min">
                                </div>
                                <div class="form-group">
                                    <label for="spo2">SpO2</label>
                                    <input type="text" id="spo2" placeholder="98%">
                                </div>
                                <div class="form-group">
                                    <label for="weight">Weight (kg)</label>
                                    <input type="number" id="weight" step="0.1">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Diagnosis</h3>
                            <div class="form-group">
                                <label for="clinicalExamination">Clinical Examination</label>
                                <textarea id="clinicalExamination" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="provisionalDiagnosis">Provisional Diagnosis *</label>
                                <textarea id="provisionalDiagnosis" rows="2" required aria-required="true"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="finalDiagnosis">Final Diagnosis</label>
                                <textarea id="finalDiagnosis" rows="2"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="icd10Code">ICD-10 Code</label>
                                    <input type="text" id="icd10Code" placeholder="e.g., A90">
                                </div>
                                <div class="form-group">
                                    <label for="severity">Severity</label>
                                    <select id="severity">
                                        <option value="Low">Low</option>
                                        <option value="Medium" selected>Medium</option>
                                        <option value="High">High</option>
                                        <option value="Critical">Critical</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Treatment Plan</h3>
                            <div class="form-group">
                                <label for="treatmentPlan">Treatment Plan</label>
                                <textarea id="treatmentPlan" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="medicationsPrescribed">Medications Prescribed</label>
                                <textarea id="medicationsPrescribed" rows="3" placeholder="Medication, dosage, frequency"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="investigationsOrdered">Investigations Ordered</label>
                                <textarea id="investigationsOrdered" rows="2"></textarea>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Follow-up Instructions</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="followUpDate">Follow-up Date</label>
                                    <input type="date" id="followUpDate">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="followUpInstructions">Follow-up Instructions</label>
                                <textarea id="followUpInstructions" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="lifestyleAdvice">Lifestyle & Dietary Advice</label>
                                <textarea id="lifestyleAdvice" rows="2"></textarea>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Additional Information</h3>
                            <div class="form-group">
                                <label for="additionalNotes">Additional Notes</label>
                                <textarea id="additionalNotes" rows="3"></textarea>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" id="cancelRecord" class="btn btn-secondary">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Medical Record</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </section>

    <script src="app.js"></script>
</body>
</html>
